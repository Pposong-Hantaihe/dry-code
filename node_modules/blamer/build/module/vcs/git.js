import execa from 'execa';
import which from 'which';
const convertStringToObject = (sourceLine) => {
    const matches = sourceLine.match(/(.+)\s+\((.+)\s+(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2} (\+|\-)\d{4})\s+(\d+)\)(.*)/);
    const [, rev, author, date, , line] = matches
        ? [...matches]
        : [null, '', '', '', '', ''];
    return {
        author,
        date,
        line,
        rev
    };
};
export async function git(path) {
    const blamedLines = {};
    const pathToGit = await which('git');
    const result = execa.sync(pathToGit, ['blame', '-w', path]);
    result.stdout.split('\n').forEach(line => {
        if (line !== '') {
            const blamedLine = convertStringToObject(line);
            if (blamedLine.line) {
                blamedLines[blamedLine.line] = blamedLine;
            }
        }
    });
    return {
        [path]: blamedLines
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2l0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3Zjcy9naXQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLE1BQU0sT0FBTyxDQUFDO0FBQzFCLE9BQU8sS0FBSyxNQUFNLE9BQU8sQ0FBQztBQUcxQixNQUFNLHFCQUFxQixHQUFHLENBQUMsVUFBa0IsRUFBYyxFQUFFO0lBQy9ELE1BQU0sT0FBTyxHQUFHLFVBQVUsQ0FBQyxLQUFLLENBQzlCLGtGQUFrRixDQUNuRixDQUFDO0lBQ0YsTUFBTSxDQUFDLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsQUFBRCxFQUFHLElBQUksQ0FBQyxHQUFHLE9BQU87UUFDM0MsQ0FBQyxDQUFDLENBQUMsR0FBRyxPQUFPLENBQUM7UUFDZCxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQy9CLE9BQU87UUFDTCxNQUFNO1FBQ04sSUFBSTtRQUNKLElBQUk7UUFDSixHQUFHO0tBQ0osQ0FBQztBQUNKLENBQUMsQ0FBQztBQUVGLE1BQU0sQ0FBQyxLQUFLLFVBQVUsR0FBRyxDQUFDLElBQVk7SUFDcEMsTUFBTSxXQUFXLEdBQW1DLEVBQUUsQ0FBQztJQUN2RCxNQUFNLFNBQVMsR0FBVyxNQUFNLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUM3QyxNQUFNLE1BQU0sR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUM1RCxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUU7UUFDdkMsSUFBSSxJQUFJLEtBQUssRUFBRSxFQUFFO1lBQ2YsTUFBTSxVQUFVLEdBQUcscUJBQXFCLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDL0MsSUFBSSxVQUFVLENBQUMsSUFBSSxFQUFFO2dCQUNuQixXQUFXLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxHQUFHLFVBQVUsQ0FBQzthQUMzQztTQUNGO0lBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDSCxPQUFPO1FBQ0wsQ0FBQyxJQUFJLENBQUMsRUFBRSxXQUFXO0tBQ3BCLENBQUM7QUFDSixDQUFDIn0=