"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const execa_1 = __importDefault(require("execa"));
const which_1 = __importDefault(require("which"));
const convertStringToObject = (sourceLine) => {
    const matches = sourceLine.match(/(.+)\s+\((.+)\s+(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2} (\+|\-)\d{4})\s+(\d+)\)(.*)/);
    const [, rev, author, date, , line] = matches
        ? [...matches]
        : [null, '', '', '', '', ''];
    return {
        author,
        date,
        line,
        rev
    };
};
async function git(path) {
    const blamedLines = {};
    const pathToGit = await which_1.default('git');
    const result = execa_1.default.sync(pathToGit, ['blame', '-w', path]);
    result.stdout.split('\n').forEach(line => {
        if (line !== '') {
            const blamedLine = convertStringToObject(line);
            if (blamedLine.line) {
                blamedLines[blamedLine.line] = blamedLine;
            }
        }
    });
    return {
        [path]: blamedLines
    };
}
exports.git = git;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2l0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3Zjcy9naXQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxrREFBMEI7QUFDMUIsa0RBQTBCO0FBRzFCLE1BQU0scUJBQXFCLEdBQUcsQ0FBQyxVQUFrQixFQUFjLEVBQUU7SUFDL0QsTUFBTSxPQUFPLEdBQUcsVUFBVSxDQUFDLEtBQUssQ0FDOUIsa0ZBQWtGLENBQ25GLENBQUM7SUFDRixNQUFNLENBQUMsRUFBRSxHQUFHLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxBQUFELEVBQUcsSUFBSSxDQUFDLEdBQUcsT0FBTztRQUMzQyxDQUFDLENBQUMsQ0FBQyxHQUFHLE9BQU8sQ0FBQztRQUNkLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDL0IsT0FBTztRQUNMLE1BQU07UUFDTixJQUFJO1FBQ0osSUFBSTtRQUNKLEdBQUc7S0FDSixDQUFDO0FBQ0osQ0FBQyxDQUFDO0FBRUssS0FBSyxVQUFVLEdBQUcsQ0FBQyxJQUFZO0lBQ3BDLE1BQU0sV0FBVyxHQUFtQyxFQUFFLENBQUM7SUFDdkQsTUFBTSxTQUFTLEdBQVcsTUFBTSxlQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDN0MsTUFBTSxNQUFNLEdBQUcsZUFBSyxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQyxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDNUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO1FBQ3ZDLElBQUksSUFBSSxLQUFLLEVBQUUsRUFBRTtZQUNmLE1BQU0sVUFBVSxHQUFHLHFCQUFxQixDQUFDLElBQUksQ0FBQyxDQUFDO1lBQy9DLElBQUksVUFBVSxDQUFDLElBQUksRUFBRTtnQkFDbkIsV0FBVyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxVQUFVLENBQUM7YUFDM0M7U0FDRjtJQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0gsT0FBTztRQUNMLENBQUMsSUFBSSxDQUFDLEVBQUUsV0FBVztLQUNwQixDQUFDO0FBQ0osQ0FBQztBQWZELGtCQWVDIn0=